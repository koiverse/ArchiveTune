# Gemini Code Assist Configuration for ArchiveTune
# This file configures Gemini AI assistant behavior for the ArchiveTune project

version: 1.0

# Project-specific settings
project:
  name: ArchiveTune
  type: Android Application
  language: Kotlin
  framework: Jetpack Compose
  architecture: Clean Architecture + MVVM

# Code generation settings
generation:
  # Default code style preferences
  style:
    language_level: Kotlin 1.9+
    parenthesis_style: same_line  # (args) - follows Kotlin convention
    blank_lines: 2  # Blank lines between declarations
    trailing_comma: true  # Use trailing commas

  # Import organization
  imports:
    group_imports: false  # No wildcard imports
    sort_order:
      - kotlin.*
      - androidx.*
      - androidx.compose.*
      - com.google.*
      - org.jetbrains.*
      - org.jetbrains.kotlinx.*
      - moe.koiverse.archivetune.*
      - project modules (innertube, kugou, lrclib, etc.)
      - third-party libraries

# Kotlin-specific conventions
kotlin:
  # Naming conventions
  naming:
    classes: PascalCase (e.g., HomeViewModel, MusicDatabase)
    interfaces: PascalCase with "I" prefix optional (e.g., Repository, LyricsProvider)
    functions: camelCase (e.g., getPlaylists, isUserLoggedIn)
    properties: camelCase (e.g., isLoading, userData)
    constants: SCREAMING_SNAKE_CASE (e.g., MAX_RETRY_COUNT)
    type_parameters: Single uppercase letter or PascalCase (e.g., T, ItemType)
    packages: lowercase (e.g., moe.koiverse.archivetune)

  # Function conventions
  functions:
    max_parameters: 5  # Prefer data classes beyond this
    prefer_expression_bodies: true
    single_expression_bodies: true when simple
    avoid_return_null: Use nullable types with ?: null

  # Class conventions
  classes:
    primary_constructor_properties: Use primary constructor for essential properties
    data_classes: Use for holding data (auto-generated equals, hashCode, copy)
    sealed_classes: Use for restricted hierarchies (e.g., Result<T>, UiState)
    companion_object: Use for static members and constants

# Compose-specific settings
compose:
  # Naming conventions
  naming:
    composables: PascalCase starting with verb (e.g., HomeScreen, PlayerControls)
    remember_keys: Use stable keys (e.g., remember { mutableStateOf(0) })

  # Best practices
  practices:
    state_hoisting: Always hoist state to the lowest common ancestor
    recomposition_optimization: Use remember { key } to prevent unnecessary recomposition
    avoid_unstable_collections: Use immutable collections (listOf, setOf, mapOf)
    derived_state: Use derivedStateOf for expensive computations
    composition_local: Use LocalComposition for dependency injection

  # Material3 usage
  material3:
    use_material3_components: true
    prefer_material_theme: true
    support_dark_theme: true

# Architecture settings
architecture:
  pattern: Clean Architecture + MVVM
  layers:
    - UI Layer (Compose screens, ViewModels)
    - Domain Layer (Use cases, Repository interfaces)
    - Data Layer (Repository implementations, Data sources)
    - Service Layer (Media3, background services)

  # Package structure
  package_structure:
    root: moe.koiverse.archivetune
    subpackages:
      - ui.* (Compose screens)
      - viewmodels.* (ViewModels)
      - domain.* (Use cases, repository interfaces)
      - data.* (Repository implementations)
      - db.* (Room database, DAOs, entities)
      - extensions.* (Extension functions)
      - utils.* (Utility classes and functions)
      - models.* (Data transfer objects)
      - constants.* (Constants and enums)
      - lyrics.* (Lyrics providers)
      - networking.* (API clients)

# Dependency Injection (Hilt)
dependency_injection:
  framework: Hilt
  conventions:
    use_hilt_annotations: true
    field_injection: Prefer constructor injection where possible
    hilt_viewmodel: Use @HiltViewModel for ViewModels
    hilt_module: Use @Module and @InstallIn for modules

# Database (Room)
database:
  framework: Room
  conventions:
    use_room_annotations: true
    dao_suffix: DAO (e.g., MusicDao)
    entity_suffix: Entity (e.g., SongEntity)
    table_name: Use @Entity annotation
    foreign_keys: Use @ForeignKey for relationships
    indices: Use @Index for frequently queried columns

# Async and Concurrency
concurrency:
  framework: Kotlin Coroutines + Flow
  conventions:
    use_coroutines: true for async operations
    use_flow: true for reactive streams
    use_stateflow: for UI state (mutableStateFlow â†’ stateFlow)
    use_sharedflow: for one-time events (e.g., navigation, toasts)
    structured_concurrency: Use coroutineScope within ViewModels

# Build configuration
build:
  gradle:
    version_catalog: libs.versions.toml
    kotlin_version: "2.0+"
    java_version: 21
    compose_version: from version catalog
    min_sdk: 26
    target_sdk: 36
    compile_sdk: 36

  # Build flavors
  flavors:
    - universal (all ABIs)
    - arm64 (arm64-v8a)
    - armeabi (armeabi-v7a)
    - x86
    - x86_64

# Testing requirements
testing:
  unit_testing: Required for ViewModels and Use Cases
  lint_checks: Required (./gradlew lintDebug)
  code_formatting: Required (./gradlew ktlintCheck)

# Security guidelines
security:
  api_keys: Store in local.properties or environment variables
  sensitive_data: Never log sensitive information
  obfuscation: R8 minification enabled for release builds

# Code quality gates
quality_gates:
  must_run_before_pr:
    - ./gradlew lintDebug
    - ./gradlew ktlintCheck
    - ./gradlew testDebugUnitTest

# Documentation requirements
documentation:
  public_apis: KDoc comments required
  complex_functions: KDoc comments required
  viewmodels: Document UI state and events
  repository_methods: Document data sources and caching behavior

# AI Agent Code Review Rules
ai_agent_rules:
  # Fix all issues automatically
  fix_all_issues: |
    When AI agents are used to fix issues, they must:
    1. Fix ALL issues identified, not just some
    2. Apply all lint warnings and suggestions
    3. Fix all compiler warnings and errors
    4. Address all code smells detected by static analysis
    5. Correct all formatting violations
    6. Handle all null safety warnings
    7. Resolve all performance concerns
    8. Fix all security vulnerabilities
    9. Apply all accessibility improvements
    10. Update documentation if API signatures change
    
    AI agents should never partially fix issues or leave known problems unaddressed.
    
    Prompt for fix all issues with AI Agents:
    """
    Fix ALL issues in the code. This includes:
    - All lint warnings and errors
    - All compiler warnings and errors
    - All code smells and anti-patterns
    - All formatting violations (ktlint)
    - All null safety issues
    - All performance concerns
    - All security vulnerabilities
    - All accessibility issues
    
    Do not leave any known issues unfixed. Apply all necessary changes to resolve every identified problem.
    """
